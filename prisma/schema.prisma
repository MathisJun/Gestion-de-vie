// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  name          String?
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  
  householdMembers HouseholdMember[]
  
  @@map("users")
}

model Household {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  
  members         HouseholdMember[]
  groceryCategories GroceryCategory[]
  groceryLists    GroceryList[]
  subscriptions   Subscription[]
  trips           Trip[]
  restaurants     Restaurant[]
  movies          Movie[]
  fuelEntries     FuelEntry[]
  
  @@map("households")
}

model HouseholdMember {
  householdId String   @map("household_id")
  userId      String   @map("user_id")
  role        String   @default("member") // "owner" | "member"
  createdAt   DateTime @default(now()) @map("created_at")
  
  household Household @relation(fields: [householdId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@id([householdId, userId])
  @@map("household_members")
}

model GroceryCategory {
  id          String   @id @default(uuid())
  householdId String   @map("household_id")
  name        String
  createdAt   DateTime @default(now()) @map("created_at")
  
  household Household    @relation(fields: [householdId], references: [id], onDelete: Cascade)
  items     GroceryItem[]
  
  @@unique([householdId, name])
  @@map("grocery_categories")
}

model GroceryList {
  id          String   @id @default(uuid())
  householdId String   @map("household_id")
  name        String   @default("Liste principale")
  createdAt   DateTime @default(now()) @map("created_at")
  
  household Household    @relation(fields: [householdId], references: [id], onDelete: Cascade)
  items     GroceryItem[]
  
  @@map("grocery_lists")
}

model GroceryItem {
  id         String            @id @default(uuid())
  listId     String            @map("list_id")
  name       String
  quantity   String?
  categoryId String?           @map("category_id")
  status     GroceryItemStatus @default(HOME)
  notes      String?
  createdAt  DateTime          @default(now()) @map("created_at")
  updatedAt DateTime          @updatedAt @map("updated_at")
  
  list     GroceryList      @relation(fields: [listId], references: [id], onDelete: Cascade)
  category GroceryCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  
  @@map("grocery_items")
}

enum GroceryItemStatus {
  HOME
  MUST_BUY
  BOUGHT
}

model Subscription {
  id            String        @id @default(uuid())
  householdId   String        @map("household_id")
  name          String
  provider      String?
  billingCycle  BillingCycle  @map("billing_cycle")
  price         Decimal       @db.Decimal(10, 2)
  startDate     DateTime      @db.Date @map("start_date")
  endDate       DateTime?     @db.Date @map("end_date")
  nextRenewal   DateTime?     @db.Date @map("next_renewal")
  paymentMethod String?       @map("payment_method")
  notes         String?
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  
  household Household @relation(fields: [householdId], references: [id], onDelete: Cascade)
  
  @@map("subscriptions")
}

enum BillingCycle {
  monthly
  yearly
}

model Trip {
  id          String     @id @default(uuid())
  householdId String     @map("household_id")
  title       String
  country     String?
  city        String?
  startDate   DateTime?  @db.Date @map("start_date")
  endDate     DateTime?  @db.Date @map("end_date")
  description String?
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  
  household Household  @relation(fields: [householdId], references: [id], onDelete: Cascade)
  spots     TripSpot[]
  
  @@map("trips")
}

model TripSpot {
  id          String   @id @default(uuid())
  tripId      String   @map("trip_id")
  title       String
  lat         Decimal  @db.Decimal(10, 8)
  lng         Decimal  @db.Decimal(11, 8)
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  
  trip   Trip        @relation(fields: [tripId], references: [id], onDelete: Cascade)
  media  TripMedia[]
  
  @@map("trip_spots")
}

model TripMedia {
  id         String    @id @default(uuid())
  spotId     String    @map("spot_id")
  storagePath String   @map("storage_path")
  mediaType  MediaType @map("media_type")
  createdAt  DateTime  @default(now()) @map("created_at")
  
  spot TripSpot @relation(fields: [spotId], references: [id], onDelete: Cascade)
  
  @@map("trip_media")
}

enum MediaType {
  image
  video
}

model Restaurant {
  id           String      @id @default(uuid())
  householdId  String      @map("household_id")
  name         String
  address      String?
  lat          Decimal?    @db.Decimal(10, 8)
  lng          Decimal?   @db.Decimal(11, 8)
  rating       Int?
  cuisine      String?
  priceLevel   PriceLevel? @map("price_level")
  notes        String?
  googleMapsUrl String?    @map("google_maps_url")
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")
  
  household Household @relation(fields: [householdId], references: [id], onDelete: Cascade)
  
  @@map("restaurants")
}

enum PriceLevel {
  €
  €€
  €€€
  €€€€
}

model Movie {
  id         String      @id @default(uuid())
  householdId String     @map("household_id")
  title      String
  year       Int?
  status     MovieStatus @default(TO_WATCH)
  rating     Int?
  notes      String?
  createdAt  DateTime    @default(now()) @map("created_at")
  updatedAt  DateTime    @updatedAt @map("updated_at")
  
  household Household @relation(fields: [householdId], references: [id], onDelete: Cascade)
  
  @@map("movies")
}

enum MovieStatus {
  TO_WATCH
  WATCHED
}

model FuelEntry {
  id          String   @id @default(uuid())
  householdId String   @map("household_id")
  date        DateTime @db.Date
  odometerKm  Decimal  @db.Decimal(10, 2) @map("odometer_km")
  liters      Decimal  @db.Decimal(6, 2)
  totalPrice  Decimal  @db.Decimal(10, 2) @map("total_price")
  station     String?
  createdAt   DateTime @default(now()) @map("created_at")
  
  household Household @relation(fields: [householdId], references: [id], onDelete: Cascade)
  
  @@map("fuel_entries")
}
